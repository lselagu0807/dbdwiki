<div class="perks-container">
    <div class="perks-header">
        <h2 class="text-white text-uppercase fw-bold">Perks de los Survivors</h2>
    </div>

    <div class="perks-controls">
        <div class="search-box">
            <input type="text" [(ngModel)]="searchTerm" (input)="filterPerks()" placeholder="Buscar por perk, descripci√≥n o survivor..." class="search-input" aria-label="Buscar perks" /> @if (searchTerm) {
            <button class="clear-search" (click)="clearSearch()" aria-label="Limpiar b√∫squeda">
          &times;
        </button> }
        </div>
    </div>

    @if (loading) {
    <div class="loader-container">
        <div class="spinner-border spinner-border-lg text-danger" role="status"></div>
        <p class="text-white mt-3">Invocando habilidades del Entity...</p>
    </div>
    } @else if (filteredPerks.length === 0 && searchTerm) {
    <div class="no-results">
        <div class="blood-splatter"></div>
        <p class="text-white-50">No se encontraron habilidades con "<strong>{{ searchTerm }}</strong>"</p>
        <button class="btn-reset" (click)="clearSearch()">Ver todos los perks</button>
    </div>
    } @else if (filteredPerks.length === 0) {
    <div class="no-results">
        <p class="text-white-50">No hay perks disponibles en este momento</p>
    </div>
    } @else {
    <div class="perks-grid">
        @for (perk of getCurrentPagePerks(); track perk.id) {
        <div class="perk-card" (click)="viewPerkDetails(perk)" role="button" tabindex="0">
            <div class="perk-diamond-frame">
                <div class="diamond-inner">
                    <img [src]="perk.icon" [alt]="perk.name" class="perk-img">
                    <div class="perk-shine"></div>
                    <div class="perk-glow-effect"></div>
                </div>
            </div>
            <div class="perk-footer">
                <span class="perk-name">{{ perk.name }}</span>
                <small class="perk-owner">{{ perk.survivorName }}</small>
            </div>
        </div>
        }
    </div>

    <!-- üîë CONTROLES DE PAGINACI√ìN -->
    @if (totalPages > 1) {
    <div class="pagination-controls" aria-label="Navegaci√≥n de p√°ginas">
        <button class="page-btn prev-btn" (click)="prevPage()" [disabled]="currentPage === 1" aria-label="P√°gina anterior">
          <span class="blood-icon">&laquo;</span>
        </button>

        <div class="page-numbers">
            @if (currentPage > 4) {
            <button class="page-number" (click)="setPage(1)">1</button>
            <span class="ellipsis">...</span> } @for (page of getPageNumbers(); track page) {
            <button class="page-number {{ page === currentPage ? 'active' : '' }}" (click)="setPage(page)" [attr.aria-current]="page === currentPage ? 'page' : null">
              {{ page }}
            </button> } @if (currentPage
            < totalPages - 3) { <span class="ellipsis">...</span>
                <button class="page-number" (click)="setPage(totalPages)">{{ totalPages }}</button> }
        </div>

        <button class="page-btn next-btn" (click)="nextPage()" [disabled]="currentPage === totalPages" aria-label="P√°gina siguiente">
          <span class="blood-icon">&raquo;</span>
        </button>
    </div>
    } }

    <!-- MODAL DE DETALLES -->
    @if (isDetailOpen && selectedPerk) {
    <div class="perk-overlay active" (click)="closePerkDetails()"></div>
    <div class="perk-modal active">

        <div class="perk-modal-header">
            <div class="title-wrap">
                <div class="modal-perk-icon">
                    <div class="diamond-small">
                        <img [src]="selectedPerk.icon" [alt]="selectedPerk.name">
                    </div>
                </div>
                <div>
                    <h2 class="text-uppercase">{{ selectedPerk.name }}</h2>
                    <span class="badge-teachable">{{ selectedPerk.survivorName }}</span>
                </div>
            </div>
            <button class="close-btn" (click)="closePerkDetails()" aria-label="Cerrar">&times;</button>
        </div>

        <div class="perk-modal-body">

            <div class="rarity-badge-container">
                <span class="rarity-badge rarity-teachable">Teachable Perk</span>
            </div>

            <div class="desc-box">
                <p class="desc-title">‚ö° Descripci√≥n</p>
                <p class="desc-text">{{ selectedPerk.description }}</p>
            </div>

            <div class="perk-meta">
                <span><strong>Survivor:</strong> {{ selectedPerk.survivorName }}</span>
                
            </div>

        </div>
    </div>
    }
</div>